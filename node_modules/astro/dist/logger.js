import {bold, blue, red, grey, underline, yellow} from "kleur/colors";
import {Writable} from "stream";
import {format as utilFormat} from "util";
import stringWidth from "string-width";
const defaultLogDestination = new Writable({
  objectMode: true,
  write(event, _, callback) {
    let dest = process.stderr;
    if (levels[event.level] < levels["error"]) {
      dest = process.stdout;
    }
    let type = event.type;
    if (type !== null) {
      if (event.level === "info") {
        type = bold(blue(type));
      } else if (event.level === "warn") {
        type = bold(yellow(type));
      } else if (event.level === "error") {
        type = bold(red(type));
      }
      dest.write(`[${type}] `);
    }
    dest.write(utilFormat(...event.args));
    dest.write("\n");
    callback();
  }
});
const defaultLogOptions = {
  dest: defaultLogDestination,
  level: "info"
};
const levels = {
  debug: 20,
  info: 30,
  warn: 40,
  error: 50,
  silent: 90
};
function log(opts = defaultLogOptions, level, type, ...args) {
  const event = {
    type,
    level,
    args,
    message: ""
  };
  if (levels[opts.level] > levels[level]) {
    return;
  }
  opts.dest.write(event);
}
function debug(opts, type, ...messages) {
  return log(opts, "debug", type, ...messages);
}
function info(opts, type, ...messages) {
  return log(opts, "info", type, ...messages);
}
function warn(opts, type, ...messages) {
  return log(opts, "warn", type, ...messages);
}
function error(opts, type, ...messages) {
  return log(opts, "error", type, ...messages);
}
function table(opts, columns) {
  return function logTable(logFn, ...input) {
    const messages = columns.map((len, i) => padStr(input[i].toString(), len));
    logFn(opts, null, ...messages);
  };
}
function parseError(opts, err) {
  if (!err.frame) {
    return error(opts, "parse-error", err.message || err);
  }
  let frame = err.frame.replace(/^([0-9]+)(:)/gm, `${bold("$1")} \u2502`).replace(/(?<=^\s+)(\^)/gm, bold(red(" ^"))).replace(/^/gm, "   ");
  error(opts, "parse-error", `

 ${underline(bold(grey(`${err.filename || ""}:${err.start.line}:${err.start.column}`)))}

 ${bold(red(`\u{1D605} ${err.message}`))}

${frame}
`);
}
const logger = {
  debug: debug.bind(null, defaultLogOptions),
  info: info.bind(null, defaultLogOptions),
  warn: warn.bind(null, defaultLogOptions),
  error: error.bind(null, defaultLogOptions)
};
function padStr(str, len) {
  const strLen = stringWidth(str);
  if (strLen > len) {
    return str.substring(0, len - 3) + "...";
  }
  const spaces = Array.from({length: len - strLen}, () => " ").join("");
  return str + spaces;
}
let defaultLogLevel;
if (process.argv.includes("--verbose")) {
  defaultLogLevel = "debug";
} else if (process.argv.includes("--silent")) {
  defaultLogLevel = "silent";
} else {
  defaultLogLevel = "info";
}
export {
  debug,
  defaultLogDestination,
  defaultLogLevel,
  defaultLogOptions,
  error,
  info,
  log,
  logger,
  parseError,
  table,
  warn
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL2xvZ2dlci50cyJdLAogICJtYXBwaW5ncyI6ICJBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTU8sTUFBTSx3QkFBd0IsSUFBSSxTQUFTO0FBQUEsRUFDaEQsWUFBWTtBQUFBLEVBQ1osTUFBTSxPQUFtQixHQUFHLFVBQVU7QUFDcEMsUUFBSSxPQUFzQixRQUFRO0FBQ2xDLFFBQUksT0FBTyxNQUFNLFNBQVMsT0FBTyxVQUFVO0FBQ3pDLGFBQU8sUUFBUTtBQUFBO0FBRWpCLFFBQUksT0FBTyxNQUFNO0FBQ2pCLFFBQUksU0FBUyxNQUFNO0FBQ2pCLFVBQUksTUFBTSxVQUFVLFFBQVE7QUFDMUIsZUFBTyxLQUFLLEtBQUs7QUFBQSxpQkFDUixNQUFNLFVBQVUsUUFBUTtBQUNqQyxlQUFPLEtBQUssT0FBTztBQUFBLGlCQUNWLE1BQU0sVUFBVSxTQUFTO0FBQ2xDLGVBQU8sS0FBSyxJQUFJO0FBQUE7QUFHbEIsV0FBSyxNQUFNLElBQUk7QUFBQTtBQUdqQixTQUFLLE1BQU0sV0FBVyxHQUFHLE1BQU07QUFDL0IsU0FBSyxNQUFNO0FBRVg7QUFBQTtBQUFBO0FBZ0JHLE1BQU0sb0JBQWdDO0FBQUEsRUFDM0MsTUFBTTtBQUFBLEVBQ04sT0FBTztBQUFBO0FBVVQsTUFBTSxTQUFzQztBQUFBLEVBQzFDLE9BQU87QUFBQSxFQUNQLE1BQU07QUFBQSxFQUNOLE1BQU07QUFBQSxFQUNOLE9BQU87QUFBQSxFQUNQLFFBQVE7QUFBQTtBQUlILGFBQWEsT0FBbUIsbUJBQW1CLE9BQW9CLFNBQXdCLE1BQWtCO0FBQ3RILFFBQU0sUUFBb0I7QUFBQSxJQUN4QjtBQUFBLElBQ0E7QUFBQSxJQUNBO0FBQUEsSUFDQSxTQUFTO0FBQUE7QUFJWCxNQUFJLE9BQU8sS0FBSyxTQUFTLE9BQU8sUUFBUTtBQUN0QztBQUFBO0FBR0YsT0FBSyxLQUFLLE1BQU07QUFBQTtBQUlYLGVBQWUsTUFBa0IsU0FBd0IsVUFBc0I7QUFDcEYsU0FBTyxJQUFJLE1BQU0sU0FBUyxNQUFNLEdBQUc7QUFBQTtBQUk5QixjQUFjLE1BQWtCLFNBQXdCLFVBQXNCO0FBQ25GLFNBQU8sSUFBSSxNQUFNLFFBQVEsTUFBTSxHQUFHO0FBQUE7QUFJN0IsY0FBYyxNQUFrQixTQUF3QixVQUFzQjtBQUNuRixTQUFPLElBQUksTUFBTSxRQUFRLE1BQU0sR0FBRztBQUFBO0FBSTdCLGVBQWUsTUFBa0IsU0FBd0IsVUFBc0I7QUFDcEYsU0FBTyxJQUFJLE1BQU0sU0FBUyxNQUFNLEdBQUc7QUFBQTtBQUs5QixlQUFlLE1BQWtCLFNBQW1CO0FBQ3pELFNBQU8sa0JBQWtCLFVBQWlCLE9BQW1CO0FBQzNELFVBQU0sV0FBVyxRQUFRLElBQUksQ0FBQyxLQUFLLE1BQU0sT0FBTyxNQUFNLEdBQUcsWUFBWTtBQUNyRSxVQUFNLE1BQU0sTUFBTSxHQUFHO0FBQUE7QUFBQTtBQUtsQixvQkFBb0IsTUFBa0IsS0FBbUI7QUFDOUQsTUFBSSxDQUFDLElBQUksT0FBTztBQUNkLFdBQU8sTUFBTSxNQUFNLGVBQWUsSUFBSSxXQUFXO0FBQUE7QUFHbkQsTUFBSSxRQUFRLElBQUksTUFFYixRQUFRLGtCQUFrQixHQUFHLEtBQUssZ0JBRWxDLFFBQVEsbUJBQW1CLEtBQUssSUFBSSxRQUVwQyxRQUFRLE9BQU87QUFFbEIsUUFDRSxNQUNBLGVBQ0E7QUFBQTtBQUFBLEdBRUQsVUFBVSxLQUFLLEtBQUssR0FBRyxJQUFJLFlBQVksTUFBTSxJQUFJLE1BQU0sUUFBUSxJQUFJLE1BQU07QUFBQTtBQUFBLEdBRXpFLEtBQUssSUFBSSxhQUFNLElBQUk7QUFBQTtBQUFBLEVBRXBCO0FBQUE7QUFBQTtBQU1LLE1BQU0sU0FBUztBQUFBLEVBQ3BCLE9BQU8sTUFBTSxLQUFLLE1BQU07QUFBQSxFQUN4QixNQUFNLEtBQUssS0FBSyxNQUFNO0FBQUEsRUFDdEIsTUFBTSxLQUFLLEtBQUssTUFBTTtBQUFBLEVBQ3RCLE9BQU8sTUFBTSxLQUFLLE1BQU07QUFBQTtBQUcxQixnQkFBZ0IsS0FBYSxLQUFhO0FBQ3hDLFFBQU0sU0FBUyxZQUFZO0FBQzNCLE1BQUksU0FBUyxLQUFLO0FBQ2hCLFdBQU8sSUFBSSxVQUFVLEdBQUcsTUFBTSxLQUFLO0FBQUE7QUFFckMsUUFBTSxTQUFTLE1BQU0sS0FBSyxDQUFFLFFBQVEsTUFBTSxTQUFVLE1BQU0sS0FBSyxLQUFLO0FBQ3BFLFNBQU8sTUFBTTtBQUFBO0FBR1IsSUFBSTtBQUNYLElBQUksUUFBUSxLQUFLLFNBQVMsY0FBYztBQUN0QyxvQkFBa0I7QUFBQSxXQUNULFFBQVEsS0FBSyxTQUFTLGFBQWE7QUFDNUMsb0JBQWtCO0FBQUEsT0FDYjtBQUNMLG9CQUFrQjtBQUFBOyIsCiAgIm5hbWVzIjogW10KfQo=
